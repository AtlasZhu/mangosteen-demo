import{bH as _,bG as t,bY as u,bz as m,bv as S,bu as v,bB as T,bL as L,c2 as Y}from"./vendor-7c1d6fce.js";import{g as x,T as y,u as B,c as D,h as C,d as j}from"./index-cc1a54bd.js";import{i as A}from"./echarts-997109f3.js";import"./vant-1401b6a8.js";const I="_wrapper_4ourw_1",P="_topItem_4ourw_5",k="_sign_4ourw_11",q="_bar_wrapper_4ourw_22",E="_bar_text_4ourw_27",V="_bar_4ourw_22",G="_bar_inner_4ourw_41",l={wrapper:I,topItem:P,sign:k,bar_wrapper:q,bar_text:E,bar:V,bar_inner:G},N=_({props:{data:{type:Array}},setup:(e,i)=>()=>t("div",{class:l.wrapper},[e.data&&e.data.length>0?e.data.map(({tag:a,amount:r,percent:d})=>t("div",{class:l.topItem},[t("div",{class:l.sign},[a.sign]),t("div",{class:l.bar_wrapper},[t("div",{class:l.bar_text},[t("span",null,[a.name,u(" - "),d,u("%")]),t("span",null,[u("￥"),t("div",null,[x(r)])])]),t("div",{class:l.bar},[t("div",{class:l.bar_inner,style:{width:`${d}%`}},null)])])])):t("div",null,[u("没有数据")])])}),z="_wrapper_1wopj_1",H="_selectWrapper_1wopj_4",U="_chartsWrapper_1wopj_11",X="_lineChart_1wopj_14",J="_pieChart_1wopj_18",p={wrapper:z,selectWrapper:H,chartsWrapper:U,lineChart:X,pieChart:J},K={tooltip:{show:!0,trigger:"axis",formatter:([e])=>{const[i,a]=e.data;return`${new y(new Date(i)).formatAsString("YYYY年MM月DD日")} ￥${x(a)}`}},grid:[{left:16,top:20,right:16,bottom:20}],xAxis:{type:"time",boundaryGap:["3%","0%"],axisLabel:{formatter:e=>new y(new Date(e)).formatAsString("MM-DD")},axisTick:{alignWithLabel:!0}},yAxis:{show:!0,type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{show:!1}}},Q=_({props:{data:{type:Array,required:!0}},setup(e){const i=m();let a;return S(()=>{if(!i.value)return console.log("ref绑定失败");a=A(i.value),a.setOption({...K,series:[{data:e.data,type:"line"}]})}),v(()=>e.data,()=>{a.setOption({series:[{data:e.data}]})}),()=>t("div",{ref:i},null)}}),R="_wrapper_1cm6i_1",Z={wrapper:R},ee={tooltip:{trigger:"item",formatter:e=>{const{name:i,value:a,percent:r}=e;return`${i}: ￥${x(a)} 占比 ${r}%`}},grid:[{left:0,top:0,right:0,bottom:0}],series:[{type:"pie",radius:"70%",emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},te=_({props:{data:{type:Array}},setup:(e,i)=>{const a=m();let r;return S(()=>{a.value!==void 0&&(r=A(a.value),r.setOption(ee))}),v(()=>e.data,()=>{r==null||r.setOption({series:[{data:e.data}]})}),()=>t("div",{ref:a,class:Z.wrapper},null)}}),ae=24*3600*1e3,re=_({props:{startTime:{type:String,required:!1},endTime:{type:String,required:!1}},setup:(e,i)=>{const a=m("expenses"),r=m([]),d=B(),M=T(()=>{if(!e.startTime||!e.endTime||!r.value[0])return[];const s=(new Date(e.endTime).getTime()-new Date(e.startTime).getTime())/ae+1;return Array.from({length:s}).map((o,c)=>{const h=new y(e.startTime+"T00:00:00.000+0800").add(c,"day").getTimeStamp(),f=r.value[0],F=f&&new Date((f==null?void 0:f.happened_at)+"T00:00:00.000+0800").getTime()===h?r.value.shift().amount:0;return[new Date(h).toISOString(),F]})}),g=async(n,s)=>{if(console.log(e.startTime,e.endTime),!e.startTime||!e.endTime)return;await d.mePromise;const o=await C.get("/items/summary",{happened_after:e.startTime,happened_before:e.endTime,kind:a.value,group_by:"happened_at"},{_autoLoading:!0});r.value=o.data.groups,console.log(e.startTime,e.endTime,"data1",o.data)};D(g),v(()=>a.value,g);const w=m([]),$=T(()=>w.value.map(n=>({name:n.tag.name,value:n.amount}))),b=async(n,s)=>{let o,c;if(n&&s)o=n,c=s;else{if(!e.startTime||!e.endTime)return;o=e.startTime,c=e.endTime}await d.mePromise;const h=await C.get("/items/summary",{happened_after:o,happened_before:c,kind:a.value,group_by:"tag_id"});w.value=h.data.groups};D(b),v(()=>a.value,b);const O=T(()=>{const n=w.value.reduce((s,o)=>s+o.amount,0);return w.value.map(s=>({...s,percent:Math.round(s.amount/n*1e4)/100}))}),W=(n,s)=>{g(),b(n,s)};return i.expose({loadFirstPage:W}),()=>!e.endTime||!e.startTime?t("div",null,[u("请先选择时间")]):t("div",{class:p.wrapper},[t("div",{class:p.selectWrapper},[u("类型:"),L(t("select",{"onUpdate:modelValue":n=>a.value=n},[t("option",{value:"expenses"},[u("支出")]),t("option",{value:"income"},[u("收入")])]),[[Y,a.value]])]),t("div",{class:p.chartsWrapper},[t(Q,{class:p.lineChart,data:M.value},null),t(te,{class:p.pieChart,data:$.value},null),t(N,{data:O.value},null)])])}}),ue=_({setup(){return()=>t(j,{component:re,rerenderOnChangeTab:!0,hideThisYear:!0},null)}});export{ue as StatisticsPage,ue as default};
